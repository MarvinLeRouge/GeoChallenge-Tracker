{"openapi":"3.1.0","info":{"title":"GeoChallenge Tracker API","version":"0.5.0"},"paths":{"/health":{"get":{"tags":["Meta"],"summary":"Health check de l'API","description":"Retourne le statut de l'API et de ses dépendances (BDD, email, etc.)","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthCheck"}}}}}}},"/version":{"get":{"tags":["Meta"],"summary":"Version","description":"Version de l'API","operationId":"version_version_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/VersionInfo"}}}}}}},"/info":{"get":{"tags":["Meta"],"summary":"Api Info","description":"Informations générales sur l'API (optionnel)","operationId":"api_info_info_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/APIInfo"}}}}}}},"/cache_types":{"get":{"summary":"Get all cache types","description":"Get all available cache types.","operationId":"get_cache_types_cache_types_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/cache_sizes":{"get":{"summary":"Get all cache sizes","description":"Get all available cache sizes.","operationId":"get_cache_sizes_cache_sizes_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/auth/register":{"post":{"tags":["auth"],"summary":"Inscription d’un nouvel utilisateur","description":"Crée un compte utilisateur avec email et username uniques.\n\n- Vérifie la force du mot de passe\n- Hash le mot de passe\n- Envoie un email avec un code de vérification (24h)\n- Retourne les informations publiques du compte créé","operationId":"register_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserInRegister","description":"Données d'inscription : username, email et mot de passe."}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/login":{"post":{"tags":["auth"],"summary":"Connexion d’un utilisateur","description":"Authentifie via formulaire OAuth2 **ou** JSON (username/email + password).\n\n- Retourne un couple de jetons (access + refresh)\n- Le compte doit être vérifié\n- 401 si identifiants invalides ou compte non vérifié","operationId":"login_auth_login_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TokenPair"}}}}}}},"/auth/refresh":{"post":{"tags":["auth"],"summary":"Renouvellement du token d’accès","description":"Génère un nouveau token d’accès à partir d’un refresh token valide.\n\n- Vérifie la validité du refresh token\n- Vérifie que l’utilisateur est actif\n- Retourne un nouvel access token","operationId":"refresh_token_auth_refresh_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshTokenRequest","description":"Refresh token JWT valide."}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TokenResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/verify-email":{"get":{"tags":["auth"],"summary":"Vérification d’email par code","description":"Vérifie un code de confirmation reçu par email.\n\n- Active l’utilisateur si code valide et non expiré\n- Supprime le code et son expiration\n- Retourne un message de confirmation","operationId":"verify_email_auth_verify_email_get","parameters":[{"name":"code","in":"query","required":true,"schema":{"type":"string","description":"Code de vérification reçu par email, valide 24h.","title":"Code"},"description":"Code de vérification reçu par email, valide 24h."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MessageOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["auth"],"summary":"Vérification d’email via POST","description":"Alternative POST pour transmettre le code de vérification dans le corps JSON.","operationId":"verify_email_post_auth_verify_email_post","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/VerifyEmailBody","description":"Objet contenant le code de vérification."}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MessageOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/resend-verification":{"post":{"tags":["auth"],"summary":"Renvoi du code de vérification","description":"Régénère et renvoie un email de vérification si le compte existe et n’est pas encore activé.\n\n- Ne révèle pas si le compte existe réellement\n- Met à jour l’expiration du code (24h)","operationId":"resend_verification_auth_resend_verification_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ResendVerificationRequest","description":"Identifiant (username ou email) de l’utilisateur."}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MessageOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/caches/upload-gpx":{"post":{"tags":["caches"],"summary":"Importe des caches depuis un fichier GPX/ZIP","description":"Charge un fichier GPX (ou ZIP contenant un GPX) et importe les géocaches associées.\n\n- Optionnellement, marque les caches comme trouvées (création de `found_caches`)\n- Tente ensuite une création automatique de challenges à partir des caches importées\n- **Limite de taille** : 20 Mo\n- Supporte plusieurs formats de GPX (cgeo, pocket_query)\n- Retourne un résumé d’import et des statistiques liées aux challenges","operationId":"upload_gpx_caches_upload_gpx_post","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"import_mode","in":"query","required":false,"schema":{"enum":["all","found"],"type":"string","description":"Mode d'import: 'all' (toutes les caches) ou 'found' (mes trouvailles)","default":"all","title":"Import Mode"},"description":"Mode d'import: 'all' (toutes les caches) ou 'found' (mes trouvailles)"},{"name":"source_type","in":"query","required":false,"schema":{"enum":["auto","cgeo","pocket_query"],"type":"string","description":"Type de source GPX: 'auto' (détection automatique), 'cgeo', 'pocket_query'","default":"auto","title":"Source Type"},"description":"Type de source GPX: 'auto' (détection automatique), 'cgeo', 'pocket_query'"}],"requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_upload_gpx_caches_upload_gpx_post"}}}},"responses":{"200":{"description":"Import GPX réussi","content":{"application/json":{"schema":{}}}},"400":{"description":"Fichier GPX/ZIP invalide"},"401":{"description":"Non authentifié"},"413":{"description":"Payload too large"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/caches/by-filter":{"post":{"tags":["caches"],"summary":"Recherche de caches par filtres","description":"Retourne une liste paginée de géocaches selon des filtres combinables :\n- Texte (`$text`), type, taille, pays/état\n- Difficulté/terrain (plages min/max)\n- Période de placement (après/avant)\n- Attributs positifs/négatifs\n- BBox optionnelle et tri (-placed_at, -favorites, difficulty, terrain)","operationId":"by_filter_caches_by_filter_post","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"compact","in":"query","required":false,"schema":{"type":"boolean","description":"Retourne une version abrégée (_id, GC, title, type_id, type, size_id, size, difficulty, terrain).","default":true,"title":"Compact"},"description":"Retourne une version abrégée (_id, GC, title, type_id, type, size_id, size, difficulty, terrain)."}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CacheFilterIn","description":"Objet de filtrage et de pagination :\n- `q`: recherche plein texte\n- `type_id`, `size_id`, `country_id`, `state_id`\n- `difficulty`, `terrain`: objets `Range {min,max}`\n- `placed_after`, `placed_before`: bornes temporelles\n- `attr_pos`, `attr_neg`: listes d’attributs (ObjectId)\n- `bbox`: `{min_lat,min_lon,max_lat,max_lon}`\n- `sort`, `page`, `page_size`"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/caches/within-bbox":{"get":{"tags":["caches"],"summary":"Caches dans une bounding box","description":"Liste paginée des caches comprises dans une BBox.\n- Filtre optionnel par `type_id` et `size_id`\n- Tri: `-placed_at`, `-favorites`, `difficulty`, `terrain`\n- Pagination avec `page` et `page_size` (max 200)","operationId":"within_bbox_caches_within_bbox_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"min_lat","in":"query","required":true,"schema":{"type":"number","description":"Latitude minimale de la BBox.","title":"Min Lat"},"description":"Latitude minimale de la BBox."},{"name":"min_lon","in":"query","required":true,"schema":{"type":"number","description":"Longitude minimale de la BBox.","title":"Min Lon"},"description":"Longitude minimale de la BBox."},{"name":"max_lat","in":"query","required":true,"schema":{"type":"number","description":"Latitude maximale de la BBox.","title":"Max Lat"},"description":"Latitude maximale de la BBox."},{"name":"max_lon","in":"query","required":true,"schema":{"type":"number","description":"Longitude maximale de la BBox.","title":"Max Lon"},"description":"Longitude maximale de la BBox."},{"name":"type_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtre optionnel: identifiant de type (ObjectId).","title":"Type Id"},"description":"Filtre optionnel: identifiant de type (ObjectId)."},{"name":"size_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtre optionnel: identifiant de taille (ObjectId).","title":"Size Id"},"description":"Filtre optionnel: identifiant de taille (ObjectId)."},{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"description":"Numéro de page (≥1).","default":1,"title":"Page"},"description":"Numéro de page (≥1)."},{"name":"page_size","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"description":"Taille de page (1–200).","default":100,"title":"Page Size"},"description":"Taille de page (1–200)."},{"name":"sort","in":"query","required":false,"schema":{"enum":["-placed_at","-favorites","difficulty","terrain"],"type":"string","description":"Clé de tri: '-placed_at' (défaut), '-favorites', 'difficulty', 'terrain'.","default":"-placed_at","title":"Sort"},"description":"Clé de tri: '-placed_at' (défaut), '-favorites', 'difficulty', 'terrain'."},{"name":"compact","in":"query","required":false,"schema":{"type":"boolean","description":"Retourne une version abrégée (_id, GC, title, type_id, type, size_id, size, difficulty, terrain).","default":true,"title":"Compact"},"description":"Retourne une version abrégée (_id, GC, title, type_id, type, size_id, size, difficulty, terrain)."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/caches/within-radius":{"get":{"tags":["caches"],"summary":"Caches autour d’un point (rayon)","description":"Recherche par distance (geoNear) autour d’un point (lat, lon).\n- Requiert un index 2dsphere sur `caches.loc`\n- Filtre optionnel par `type_id` et `size_id`\n- Pagination via `page`/`page_size` (max 200)","operationId":"within_radius_caches_within_radius_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"lat","in":"query","required":true,"schema":{"type":"number","description":"Latitude du centre.","title":"Lat"},"description":"Latitude du centre."},{"name":"lon","in":"query","required":true,"schema":{"type":"number","description":"Longitude du centre.","title":"Lon"},"description":"Longitude du centre."},{"name":"radius_km","in":"query","required":false,"schema":{"type":"number","maximum":100.0,"minimum":0.1,"description":"Rayon de recherche en kilomètres (0.1–100).","default":10.0,"title":"Radius Km"},"description":"Rayon de recherche en kilomètres (0.1–100)."},{"name":"type_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtre optionnel: identifiant de type (ObjectId).","title":"Type Id"},"description":"Filtre optionnel: identifiant de type (ObjectId)."},{"name":"size_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtre optionnel: identifiant de taille (ObjectId).","title":"Size Id"},"description":"Filtre optionnel: identifiant de taille (ObjectId)."},{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"description":"Numéro de page (≥1).","default":1,"title":"Page"},"description":"Numéro de page (≥1)."},{"name":"page_size","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"description":"Taille de page (1–200).","default":100,"title":"Page Size"},"description":"Taille de page (1–200)."},{"name":"compact","in":"query","required":false,"schema":{"type":"boolean","description":"Retourne une version abrégée (_id, GC, title, type_id, type, size_id, size, difficulty, terrain).","default":true,"title":"Compact"},"description":"Retourne une version abrégée (_id, GC, title, type_id, type, size_id, size, difficulty, terrain)."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/caches/{gc}":{"get":{"tags":["caches"],"summary":"Récupère une cache par code GC","description":"Retourne une cache unique à partir de son code GC.","operationId":"get_by_gc_caches__gc__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"gc","in":"path","required":true,"schema":{"type":"string","description":"Code GC unique de la cache.","title":"Gc"},"description":"Code GC unique de la cache."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/caches/by-id/{id}":{"get":{"tags":["caches"],"summary":"Récupère une cache par identifiant MongoDB","description":"Retourne une cache unique à partir de son ObjectId (format chaîne).","operationId":"get_by_id_caches_by_id__id__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant MongoDB (ObjectId) de la cache, au format chaîne.","title":"Id"},"description":"Identifiant MongoDB (ObjectId) de la cache, au format chaîne."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/caches_elevation/caches/elevation/backfill":{"post":{"tags":["caches_elevation"],"summary":"Backfill de l’altitude manquante (admin)","description":"Complète l’altitude des caches dépourvues de valeur, par lots, en respectant les quotas du fournisseur.\n\n- Parcours paginé de la collection\n- Mode `dry_run` pour simuler sans écrire en base\n- Réservé aux administrateurs","operationId":"backfill_elevation_caches_elevation_caches_elevation_backfill_post","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":20000,"minimum":1,"description":"Nombre maximum de caches à traiter.","default":1000,"title":"Limit"},"description":"Nombre maximum de caches à traiter."},{"name":"page_size","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":10,"description":"Taille de lot pour les lectures/écritures.","default":500,"title":"Page Size"},"description":"Taille de lot pour les lectures/écritures."},{"name":"dry_run","in":"query","required":false,"schema":{"type":"boolean","description":"Si vrai, ne persiste pas les mises à jour (simulation).","default":false,"title":"Dry Run"},"description":"Si vrai, ne persiste pas les mises à jour (simulation)."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/challenges/refresh-from-caches":{"post":{"tags":["challenges"],"summary":"(Re)crée les challenges depuis les caches 'challenge'","description":"Analyse les caches marquées 'challenge' et crée/met à jour les documents de challenge.\n\n- Option: restreindre à une liste de `cache_ids`\n- Réservé aux administrateurs (dépendance `require_admin`)","operationId":"refresh_from_caches_challenges_refresh_from_caches_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshIn","description":"Paramètres d’exécution : optionnellement une liste de `cache_ids` (_id Mongo) à considérer."}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/my/challenges/sync":{"post":{"tags":["my-challenges"],"summary":"Synchroniser les UserChallenges manquants","description":"Crée les UserChallenges **manquants** pour l’utilisateur courant (statut `pending`).\n\n- N’altère pas ceux déjà existants\n- Retourne des statistiques de synchronisation","operationId":"sync_my_challenges_sync_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/my/challenges":{"get":{"tags":["my-challenges"],"summary":"Lister mes UserChallenges","description":"Retourne la liste paginée des UserChallenges de l’utilisateur.\n\n- Filtre optionnel `status` (pending|accepted|dismissed|completed)\n- Pagination via `page` et `page_size` (max 200)","operationId":"list_uc_my_challenges_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"status","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrer par statut du UserChallenge.","enum":["pending","accepted","dismissed","completed"],"title":"Status"},"description":"Filtrer par statut du UserChallenge."},{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"description":"Numéro de page (≥1).","default":1,"title":"Page"},"description":"Numéro de page (≥1)."},{"name":"page_size","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"description":"Taille de page (1–200).","default":50,"title":"Page Size"},"description":"Taille de page (1–200)."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserChallengeListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"patch":{"tags":["my-challenges"],"summary":"Patch en lot de plusieurs UserChallenges","description":"Modifie en **lot** le statut/notes/override_reason de plusieurs UserChallenges.\n\n- Non transactionnel (best-effort)\n- Max 200 items","operationId":"patch_uc_batch_my_challenges_patch","security":[{"OAuth2PasswordBearer":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/BatchPatchItem"},"description":"Tableau d’ordres de patch (uc_id, status?, notes?, override_reason?).","title":"Items"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchPatchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/challenges/{uc_id}":{"get":{"tags":["my-challenges"],"summary":"Détail d’un UserChallenge","description":"Retourne le détail d’un UserChallenge appartenant à l’utilisateur.","operationId":"get_uc_my_challenges__uc_id__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"uc_id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant du UserChallenge.","format":"objectid","pattern":"^[a-fA-F0-9]{24}$","examples":["507f1f77bcf86cd799439011"],"title":"Uc Id"},"description":"Identifiant du UserChallenge."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DetailResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"patch":{"tags":["my-challenges"],"summary":"Modifier statut/notes d’un UserChallenge","description":"Met à jour un UserChallenge : statut (`pending|accepted|dismissed|completed`), notes et `override_reason`.","operationId":"patch_uc_my_challenges__uc_id__patch","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"uc_id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant du UserChallenge.","format":"objectid","pattern":"^[a-fA-F0-9]{24}$","examples":["507f1f77bcf86cd799439011"],"title":"Uc Id"},"description":"Identifiant du UserChallenge."}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PatchUCIn","description":"Champs modifiables : `status`, `notes`, `override_reason`."}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PatchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/challenges/basics/calendar":{"get":{"tags":["my-challenges"],"summary":"Verify user's calendar completion","description":"Verify if the current user has completed the calendar challenge.\n\nReturns completion status for both 365-day and 366-day scenarios.\nOptional filtering by cache type and/or cache size.\n\nArgs:\n    user_id: Current user ID (from JWT token).\n    cache_type: Optional cache type name for filtering.\n    cache_size: Optional cache size name for filtering.\n\nReturns:\n    CalendarResult: Calendar completion status and details.","operationId":"verify_calendar_my_challenges_basics_calendar_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"cache_type","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Optional cache type name filter","title":"Cache Type"},"description":"Optional cache type name filter"},{"name":"cache_size","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Optional cache size name filter","title":"Cache Size"},"description":"Optional cache size name filter"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CalendarResult"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/challenges/basics/matrix":{"get":{"tags":["my-challenges"],"summary":"Verify user's D/T matrix completion","description":"Verify if the current user has completed the D/T matrix challenge.\n\nReturns completion status for 9x9 matrix (difficulty 1.0-5.0 × terrain 1.0-5.0 by 0.5).\nOptional filtering by cache type and/or cache size.\n\nArgs:\n    user_id: Current user ID (from JWT token).\n    cache_type: Optional cache type name for filtering.\n    cache_size: Optional cache size name for filtering.\n\nReturns:\n    MatrixResult: D/T matrix completion status and details.","operationId":"verify_matrix_my_challenges_basics_matrix_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"cache_type","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Optional cache type name filter","title":"Cache Type"},"description":"Optional cache type name filter"},{"name":"cache_size","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Optional cache size name filter","title":"Cache Size"},"description":"Optional cache size name filter"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MatrixResult"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/challenges/{uc_id}/tasks":{"get":{"tags":["my-challenge-tasks"],"summary":"Lister les tâches d’un UserChallenge","description":"Retourne la liste **ordonnée** des tâches associées au UserChallenge.","operationId":"get_tasks_my_challenges__uc_id__tasks_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"uc_id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant du UserChallenge.","format":"objectid","pattern":"^[a-fA-F0-9]{24}$","examples":["507f1f77bcf86cd799439011"],"title":"Uc Id"},"description":"Identifiant du UserChallenge."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TasksListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"put":{"tags":["my-challenge-tasks"],"summary":"Remplacer toutes les tâches d’un UserChallenge","description":"Remplace **l’intégralité** des tâches (avec leur ordre) pour le UserChallenge.","operationId":"put_tasks_route_my_challenges__uc_id__tasks_put","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"uc_id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant du UserChallenge.","format":"objectid","pattern":"^[a-fA-F0-9]{24}$","examples":["507f1f77bcf86cd799439011"],"title":"Uc Id"},"description":"Identifiant du UserChallenge."}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TasksPutIn","description":"Liste complète de tâches à appliquer (ordre inclus)."}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TasksListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/challenges/{uc_id}/tasks/validate":{"post":{"tags":["my-challenge-tasks"],"summary":"Valider une liste de tâches (sans persistance)","description":"Valide la cohérence d’une liste de tâches **sans l’enregistrer**.","operationId":"validate_tasks_route_my_challenges__uc_id__tasks_validate_post","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"uc_id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant du UserChallenge.","format":"objectid","pattern":"^[a-fA-F0-9]{24}$","examples":["507f1f77bcf86cd799439011"],"title":"Uc Id"},"description":"Identifiant du UserChallenge."}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TasksValidateIn","description":"Liste de tâches à valider."}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TasksValidateResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/challenges/{uc_id}/progress":{"get":{"tags":["my-challenge-progress"],"summary":"Obtenir le dernier snapshot et l’historique court","description":"Retourne le **dernier snapshot** de progression d’un UserChallenge et un **mini-historique** (limité).\n\n- 404 si le UserChallenge n’appartient pas à l’utilisateur ou n’existe pas\n- L’historique peut être restreint via `before` et `limit`","operationId":"get_progress_route_my_challenges__uc_id__progress_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"uc_id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant du UserChallenge.","format":"objectid","pattern":"^[a-fA-F0-9]{24}$","examples":["507f1f77bcf86cd799439011"],"title":"Uc Id"},"description":"Identifiant du UserChallenge."},{"name":"before","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"description":"Ne renvoyer que l’historique **antérieur** à ce timestamp.","title":"Before"},"description":"Ne renvoyer que l’historique **antérieur** à ce timestamp."},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":50,"minimum":1,"description":"Nombre d’entrées d’historique à renvoyer (1–50).","default":10,"title":"Limit"},"description":"Nombre d’entrées d’historique à renvoyer (1–50)."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProgressGetResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/challenges/{uc_id}/progress/evaluate":{"post":{"tags":["my-challenge-progress"],"summary":"Évaluer et enregistrer un snapshot immédiat","description":"Force une **évaluation immédiate** de la progression et **insère** un nouveau snapshot.\n\n- Paramètre `force` réservé aux administrateurs\n- Retourne le snapshot résultant","operationId":"evaluate_progress_route_my_challenges__uc_id__progress_evaluate_post","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"uc_id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant du UserChallenge.","format":"objectid","pattern":"^[a-fA-F0-9]{24}$","examples":["507f1f77bcf86cd799439011"],"title":"Uc Id"},"description":"Identifiant du UserChallenge."},{"name":"force","in":"query","required":false,"schema":{"type":"boolean","description":"Forcer le recalcul même si aucun changement détecté (admin-only).","default":false,"title":"Force"},"description":"Forcer le recalcul même si aucun changement détecté (admin-only)."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProgressEvaluateResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/challenges/new/progress":{"post":{"tags":["my-challenge-progress"],"summary":"Évaluer le premier snapshot pour les challenges sans progression","description":"Évalue un **premier snapshot** pour les UserChallenges **acceptés** sans progression existante.\n\n- Option `include_pending` pour inclure les `pending`\n- Paramètres `limit` et `since` pour borner le traitement","operationId":"evaluate_new_progress_route_my_challenges_new_progress_post","requestBody":{"content":{"application/json":{"schema":{"anyOf":[{"$ref":"#/components/schemas/EvaluateNewPayload"},{"type":"null"}],"title":"Payload","description":"Options d’évaluation initiale : `include_pending`, `limit`, `since`."}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/my/challenges/{uc_id}/targets/evaluate":{"post":{"tags":["targets"],"summary":"Évaluer et persister les targets d’un UserChallenge","description":"Calcule les **targets** pour un UserChallenge en agrégeant les caches non trouvées qui satisfont ≥1 tâche,\ndéduplique, score, puis upsert en base.\n\n- Caps contrôlables (`limit_per_task`, `hard_limit_total`)\n- Filtre géographique optionnel (`include_geo_filter` + `lat`/`lon`/`radius_km`)\n- Option `force` pour recalculer même si des targets existent","operationId":"evaluate_targets_my_challenges__uc_id__targets_evaluate_post","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"uc_id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant du UserChallenge.","title":"Uc Id"},"description":"Identifiant du UserChallenge."},{"name":"limit_per_task","in":"query","required":false,"schema":{"type":"integer","maximum":5000,"minimum":1,"description":"Cap de calcul par tâche.","default":500,"title":"Limit Per Task"},"description":"Cap de calcul par tâche."},{"name":"hard_limit_total","in":"query","required":false,"schema":{"type":"integer","maximum":20000,"minimum":1,"description":"Cap global avant fusion/score.","default":2000,"title":"Hard Limit Total"},"description":"Cap global avant fusion/score."},{"name":"include_geo_filter","in":"query","required":false,"schema":{"type":"boolean","description":"Activer un filtre géographique pendant l’évaluation.","default":false,"title":"Include Geo Filter"},"description":"Activer un filtre géographique pendant l’évaluation."},{"name":"lat","in":"query","required":false,"schema":{"anyOf":[{"type":"number","maximum":90,"minimum":-90},{"type":"null"}],"description":"Latitude pour filtre géo (si activé).","title":"Lat"},"description":"Latitude pour filtre géo (si activé)."},{"name":"lon","in":"query","required":false,"schema":{"anyOf":[{"type":"number","maximum":180,"minimum":-180},{"type":"null"}],"description":"Longitude pour filtre géo (si activé).","title":"Lon"},"description":"Longitude pour filtre géo (si activé)."},{"name":"radius_km","in":"query","required":false,"schema":{"anyOf":[{"type":"number","exclusiveMinimum":0},{"type":"null"}],"description":"Rayon (km) requis si `include_geo_filter=true`.","title":"Radius Km"},"description":"Rayon (km) requis si `include_geo_filter=true`."},{"name":"force","in":"query","required":false,"schema":{"type":"boolean","description":"Forcer le recalcul même si des targets existent déjà.","default":false,"title":"Force"},"description":"Forcer le recalcul même si des targets existent déjà."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/challenges/{uc_id}/targets":{"get":{"tags":["targets"],"summary":"Lister les targets d’un UserChallenge","description":"Retourne la liste **paginée** des targets d’un UserChallenge.\n- Tri paramétrable (ex. `-score`, `distance`, `GC`)\n- Pagination `page`/`limit` (max 200)","operationId":"list_targets_uc_my_challenges__uc_id__targets_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"uc_id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant du UserChallenge.","title":"Uc Id"},"description":"Identifiant du UserChallenge."},{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"description":"Numéro de page.","default":1,"title":"Page"},"description":"Numéro de page."},{"name":"page_size","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"description":"Taille de page (1–200).","default":50,"title":"Page Size"},"description":"Taille de page (1–200)."},{"name":"sort","in":"query","required":false,"schema":{"type":"string","description":"Clé de tri (ex. '-score', 'distance', 'GC').","default":"-score","title":"Sort"},"description":"Clé de tri (ex. '-score', 'distance', 'GC')."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TargetListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["targets"],"summary":"Supprimer toutes les targets d’un UserChallenge","description":"Efface toutes les targets associées au UserChallenge fourni.","operationId":"clear_targets_uc_my_challenges__uc_id__targets_delete","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"uc_id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant du UserChallenge.","title":"Uc Id"},"description":"Identifiant du UserChallenge."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/challenges/{uc_id}/targets/nearby":{"get":{"tags":["targets"],"summary":"Lister les targets proches d’un point (par UC)","description":"Liste **paginée** des targets d’un UserChallenge proches d’un point (`lat`/`lon`) dans un rayon (km).\n- Si `lat`/`lon` absents, utilise la **dernière localisation** enregistrée de l’utilisateur\n- Tri par défaut: `distance`","operationId":"list_targets_uc_nearby_my_challenges__uc_id__targets_nearby_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"uc_id","in":"path","required":true,"schema":{"type":"string","description":"Identifiant du UserChallenge.","title":"Uc Id"},"description":"Identifiant du UserChallenge."},{"name":"radius_km","in":"query","required":false,"schema":{"type":"number","exclusiveMinimum":0,"description":"Rayon de recherche (km).","default":50.0,"title":"Radius Km"},"description":"Rayon de recherche (km)."},{"name":"lat","in":"query","required":false,"schema":{"anyOf":[{"type":"number","maximum":90,"minimum":-90},{"type":"null"}],"description":"Latitude ; sinon localisation enregistrée.","title":"Lat"},"description":"Latitude ; sinon localisation enregistrée."},{"name":"lon","in":"query","required":false,"schema":{"anyOf":[{"type":"number","maximum":180,"minimum":-180},{"type":"null"}],"description":"Longitude ; sinon localisation enregistrée.","title":"Lon"},"description":"Longitude ; sinon localisation enregistrée."},{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"description":"Numéro de page.","default":1,"title":"Page"},"description":"Numéro de page."},{"name":"page_size","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"description":"Taille de page (1–200).","default":50,"title":"Page Size"},"description":"Taille de page (1–200)."},{"name":"sort","in":"query","required":false,"schema":{"type":"string","description":"Clé de tri (défaut: 'distance').","default":"distance","title":"Sort"},"description":"Clé de tri (défaut: 'distance')."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TargetListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/targets":{"get":{"tags":["targets"],"summary":"Lister toutes mes targets (tous challenges)","description":"Liste **paginée** des targets sur l’ensemble des challenges de l’utilisateur.\n- Filtre optionnel `status_filter` (ex. 'accepted')\n- Tri (ex. `-score`, `distance`, `GC`)","operationId":"list_targets_all_my_targets_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"status_filter","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrer les UC (ex. 'accepted').","title":"Status Filter"},"description":"Filtrer les UC (ex. 'accepted')."},{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"description":"Numéro de page.","default":1,"title":"Page"},"description":"Numéro de page."},{"name":"page_size","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"description":"Taille de page (1–200).","default":50,"title":"Page Size"},"description":"Taille de page (1–200)."},{"name":"sort","in":"query","required":false,"schema":{"type":"string","description":"Clé de tri (ex. '-score', 'distance', 'GC').","default":"-score","title":"Sort"},"description":"Clé de tri (ex. '-score', 'distance', 'GC')."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TargetListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/targets/nearby":{"get":{"tags":["targets"],"summary":"Lister les targets proches d’un point (tous challenges)","description":"Liste **paginée** des targets proches d’un point (`lat`/`lon`) pour **tous** les challenges.\n- Si `lat`/`lon` absents, utilise la localisation enregistrée\n- Filtre de statut UC disponible (`status_filter`)","operationId":"list_targets_all_nearby_my_targets_nearby_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"radius_km","in":"query","required":false,"schema":{"type":"number","exclusiveMinimum":0,"description":"Rayon (km).","default":50.0,"title":"Radius Km"},"description":"Rayon (km)."},{"name":"lat","in":"query","required":false,"schema":{"anyOf":[{"type":"number","maximum":90,"minimum":-90},{"type":"null"}],"description":"Latitude ; sinon localisation enregistrée.","title":"Lat"},"description":"Latitude ; sinon localisation enregistrée."},{"name":"lon","in":"query","required":false,"schema":{"anyOf":[{"type":"number","maximum":180,"minimum":-180},{"type":"null"}],"description":"Longitude ; sinon localisation enregistrée.","title":"Lon"},"description":"Longitude ; sinon localisation enregistrée."},{"name":"status_filter","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrer les UC (ex. 'accepted').","title":"Status Filter"},"description":"Filtrer les UC (ex. 'accepted')."},{"name":"page","in":"query","required":false,"schema":{"type":"integer","minimum":1,"description":"Numéro de page.","default":1,"title":"Page"},"description":"Numéro de page."},{"name":"page_size","in":"query","required":false,"schema":{"type":"integer","maximum":200,"minimum":1,"description":"Taille de page (1–200).","default":50,"title":"Page Size"},"description":"Taille de page (1–200)."},{"name":"sort","in":"query","required":false,"schema":{"type":"string","description":"Clé de tri (défaut: 'distance').","default":"distance","title":"Sort"},"description":"Clé de tri (défaut: 'distance')."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TargetListResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/my/profile/location":{"get":{"tags":["my_profile"],"summary":"Obtenir ma dernière localisation","description":"Retourne la **dernière localisation** enregistrée (lat/lon, format DM, date de mise à jour).","operationId":"get_my_location_my_profile_location_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserLocationOut"}}}}},"security":[{"OAuth2PasswordBearer":[]}]},"put":{"tags":["my_profile"],"summary":"Enregistrer ou mettre à jour ma localisation","description":"Enregistre la localisation de l’utilisateur **au choix** :\n- **Position textuelle** (`position`, ex. coordonnées DM)\n- **Coordonnées numériques** (`lat`, `lon`)\n\nValide l’input et renvoie un message indiquant si une mise à jour a eu lieu.","operationId":"put_my_location_my_profile_location_put","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserLocationIn","description":"Localisation sous forme de `position` (texte) ou `lat`/`lon`."}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/my/profile":{"get":{"tags":["my_profile"],"summary":"Obtenir mon profil","description":"Retourne le profil de l'utilisateur courant.","operationId":"get_my_profile_my_profile_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserOut"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/user-stats":{"get":{"tags":["user_stats"],"summary":"Obtenir les statistiques d'un utilisateur","description":"Retourne les statistiques synthétiques de l'utilisateur courant ou d'un autre utilisateur (username en query param, nécessite droits admin).\n\n**Métriques incluses :**\n- Nombre total de caches trouvées\n- Nombre de challenges (total, actifs, terminés)\n- Dates de première/dernière cache trouvée\n- Date de création du compte\n- Dernière activité (cache ou challenge)\n\n**Accès :**\n- Sans paramètre : statistiques de l'utilisateur courant\n- Avec `username` : nécessite le rôle admin","operationId":"get_user_statistics_user_stats_get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"username","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Username de l'utilisateur cible (admin seulement)","title":"Username"},"description":"Username de l'utilisateur cible (admin seulement)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserStatsOut"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/maintenance":{"get":{"tags":["maintenance"],"summary":"Maintenance Get 1","operationId":"maintenance_get_1_maintenance_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Maintenance Get 1 Maintenance Get"}}}}},"security":[{"OAuth2PasswordBearer":[]}]},"post":{"tags":["maintenance"],"summary":"Maintenance Post 1","operationId":"maintenance_post_1_maintenance_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Maintenance Post 1 Maintenance Post"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/maintenance/db_cleanup":{"get":{"tags":["maintenance"],"summary":"Cleanup Analyze","description":"Analyse la base de données pour détecter les enregistrements orphelins.\nAnalyse du plus central vers le plus périphérique pour détecter les orphelins directs et indirects.\nSimule le processus de suppression pour détecter tous les orphelins potentiels.\nRetourne un rapport et une clé de confirmation pour le nettoyage.","operationId":"cleanup_analyze_maintenance_db_cleanup_get","security":[{"OAuth2PasswordBearer":[]}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}},"delete":{"tags":["maintenance"],"summary":"Cleanup Execute","description":"Exécute le nettoyage des enregistrements orphelins après confirmation.\nSauvegarde les données supprimées dans un fichier JSON horodaté.\nProcess collections in dependency order (most central first) to prevent creating new orphans.\n\nArgs:\n    key: Clé de confirmation obtenue via GET /db_cleanup","operationId":"cleanup_execute_maintenance_db_cleanup_delete","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"key","in":"query","required":true,"schema":{"type":"string","title":"Key"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/maintenance/db_cleanup/backups":{"get":{"tags":["maintenance"],"summary":"Cleanup List Backups","description":"Liste tous les fichiers de backup disponibles","operationId":"cleanup_list_backups_maintenance_db_cleanup_backups_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/maintenance/backups/{filepath}":{"get":{"tags":["maintenance"],"summary":"Get Backup File","description":"Télécharge un fichier de backup (db_cleanup, full_backup, etc.).","operationId":"get_backup_file_maintenance_backups__filepath__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"filepath","in":"path","required":true,"schema":{"type":"string","title":"Filepath"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/maintenance/db_full_backup":{"post":{"tags":["maintenance"],"summary":"Full Backup Create","description":"Crée un backup complet de toute la base de données.\nSauvegarde toutes les collections dans un fichier JSON horodaté.\n\n⚠️ Attention : peut être lourd sur de grosses bases de données.","operationId":"full_backup_create_maintenance_db_full_backup_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/maintenance/db_full_restore/{filename}":{"post":{"tags":["maintenance"],"summary":"Full Backup Restore","description":"Restaure une base de données complète depuis un backup.\n\nArgs:\n    filename: Nom du fichier de backup complet\n    dry_run: Si True, simule la restauration sans insérer (défaut: True)\n    drop_existing: Si True, vide les collections avant restauration (défaut: False)\n\n⚠️ DANGER : drop_existing=True supprime toutes les données existantes !","operationId":"full_backup_restore_maintenance_db_full_restore__filename__post","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"filename","in":"path","required":true,"schema":{"type":"string","title":"Filename"}},{"name":"dry_run","in":"query","required":false,"schema":{"type":"boolean","default":true,"title":"Dry Run"}},{"name":"drop_existing","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Drop Existing"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/maintenance/db_backups":{"get":{"tags":["maintenance"],"summary":"List All Backups","description":"Liste tous les fichiers de backup (cleanup + full)","operationId":"list_all_backups_maintenance_db_backups_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/maintenance/upload-gpx":{"post":{"tags":["maintenance"],"summary":"Import GPX avec mise à jour forcée des attributs","description":"Importe un fichier GPX/ZIP et force la mise à jour des attributs pour toutes les caches.\n\n**⚠️ RESTREINT AUX ADMINISTRATEURS**\n\nFonctionne comme l'import standard mais met à jour les attributs même s'ils existent déjà.\nSupporte les mêmes formats que l'import standard (cgeo, pocket_query, etc.).\nRetourne un résumé d'import et des statistiques liées aux challenges.","operationId":"upload_gpx_maintenance_upload_gpx_post","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"import_mode","in":"query","required":false,"schema":{"enum":["all","found"],"type":"string","description":"Mode d'import: 'all' (toutes les caches) ou 'found' (mes trouvailles)","default":"all","title":"Import Mode"},"description":"Mode d'import: 'all' (toutes les caches) ou 'found' (mes trouvailles)"},{"name":"source_type","in":"query","required":false,"schema":{"enum":["auto","cgeo","pocket_query"],"type":"string","description":"Type de source GPX: 'auto' (détection automatique), 'cgeo', 'pocket_query'","default":"auto","title":"Source Type"},"description":"Type de source GPX: 'auto' (détection automatique), 'cgeo', 'pocket_query'"}],"requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_upload_gpx_maintenance_upload_gpx_post"}}}},"responses":{"200":{"description":"Import GPX réussi avec mise à jour forcée des attributs","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Upload Gpx Maintenance Upload Gpx Post"}}}},"400":{"description":"Fichier GPX/ZIP invalide"},"401":{"description":"Non authentifié"},"403":{"description":"Accès refusé (admin requis)"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"APIInfo":{"properties":{"name":{"type":"string","title":"Name"},"version":{"type":"string","title":"Version"},"build_date":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Build Date","description":"Date de build"},"documentation":{"type":"string","title":"Documentation"},"support":{"type":"string","title":"Support"}},"type":"object","required":["name","version","documentation","support"],"title":"APIInfo","description":"Informations générales sur l'API"},"AggregateProgressOut":{"properties":{"total":{"type":"number","title":"Total"},"target":{"type":"number","title":"Target"},"unit":{"type":"string","title":"Unit"}},"type":"object","required":["total","target","unit"],"title":"AggregateProgressOut","description":"Agrégat global renvoyé par l’API.\n\nAttributes:\n    total (float): Valeur courante.\n    target (float): Objectif.\n    unit (str): Unité."},"AttributeSelector":{"properties":{"cache_attribute_doc_id":{"anyOf":[{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},{"type":"null"}],"title":"Cache Attribute Doc Id"},"cache_attribute_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Cache Attribute Id"},"code":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Code","description":"Cache attribute code, e.g. 'picnic'"},"is_positive":{"type":"boolean","title":"Is Positive","default":true}},"type":"object","title":"AttributeSelector","description":"Sélecteur par attribut(s) de cache.\n\nAttributes:\n    cache_attribute_doc_id (PyObjectId | None): Réf. `cache_attributes._id`.\n    cache_attribute_id (int | None): Identifiant numérique global.\n    code (str | None): Code attribut (ex. \"picnic\").\n    is_positive (bool): True si l’attribut est affirmatif."},"BBox":{"properties":{"min_lat":{"type":"number","title":"Min Lat"},"min_lon":{"type":"number","title":"Min Lon"},"max_lat":{"type":"number","title":"Max Lat"},"max_lon":{"type":"number","title":"Max Lon"}},"type":"object","required":["min_lat","min_lon","max_lat","max_lon"],"title":"BBox","description":"Bounding box for spatial filtering."},"BatchPatchItem":{"properties":{"uc_id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Uc Id","description":"UserChallenge id","examples":["507f1f77bcf86cd799439011"]},"status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Status","description":"Nouveau statut (pending|accepted|dismissed|completed)"},"notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Notes"},"override_reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Override Reason"}},"type":"object","required":["uc_id"],"title":"BatchPatchItem","description":"Item for batch patching UserChallenges."},"BatchPatchResponse":{"properties":{"updated_count":{"type":"integer","title":"Updated Count"},"total":{"type":"integer","title":"Total"},"results":{"items":{"$ref":"#/components/schemas/BatchPatchResultItem"},"type":"array","title":"Results"}},"type":"object","required":["updated_count","total","results"],"title":"BatchPatchResponse","description":"Response for batch patching UserChallenges."},"BatchPatchResultItem":{"properties":{"uc_id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Uc Id","examples":["507f1f77bcf86cd799439011"]},"ok":{"type":"boolean","title":"Ok"},"error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error"}},"type":"object","required":["uc_id","ok"],"title":"BatchPatchResultItem","description":"Result item for batch patching."},"Body_upload_gpx_caches_upload_gpx_post":{"properties":{"file":{"type":"string","format":"binary","title":"File","description":"Fichier GPX à importer (ou ZIP contenant un GPX)."}},"type":"object","required":["file"],"title":"Body_upload_gpx_caches_upload_gpx_post"},"Body_upload_gpx_maintenance_upload_gpx_post":{"properties":{"file":{"type":"string","format":"binary","title":"File","description":"Fichier GPX à importer (ou ZIP contenant un GPX)."}},"type":"object","required":["file"],"title":"Body_upload_gpx_maintenance_upload_gpx_post"},"CacheDetail":{"properties":{"id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Id","examples":["507f1f77bcf86cd799439011"]},"GC":{"type":"string","title":"Gc"},"difficulty":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Difficulty"},"terrain":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Terrain"}},"type":"object","required":["id","GC"],"title":"CacheDetail","description":"Détail minimal cache.\n\nAttributes:\n    id (PyObjectId): Id cache.\n    GC (str): Code GC."},"CacheFilterIn":{"properties":{"q":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Q"},"type_id":{"anyOf":[{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},{"type":"null"}],"title":"Type Id"},"size_id":{"anyOf":[{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},{"type":"null"}],"title":"Size Id"},"country_id":{"anyOf":[{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},{"type":"null"}],"title":"Country Id"},"state_id":{"anyOf":[{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},{"type":"null"}],"title":"State Id"},"difficulty":{"anyOf":[{"$ref":"#/components/schemas/Range"},{"type":"null"}]},"terrain":{"anyOf":[{"$ref":"#/components/schemas/Range"},{"type":"null"}]},"placed_after":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Placed After"},"placed_before":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Placed Before"},"attr_pos":{"anyOf":[{"items":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},"type":"array"},{"type":"null"}],"title":"Attr Pos"},"attr_neg":{"anyOf":[{"items":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},"type":"array"},{"type":"null"}],"title":"Attr Neg"},"bbox":{"anyOf":[{"$ref":"#/components/schemas/BBox"},{"type":"null"}]},"sort":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Sort","description":"e.g. -placed_at, -favorites, difficulty, terrain","default":"-placed_at"},"page":{"type":"integer","title":"Page","default":1},"page_size":{"type":"integer","title":"Page Size","default":50}},"type":"object","title":"CacheFilterIn","description":"Input schema for cache filtering and pagination."},"CacheTypeStats":{"properties":{"type_id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Type Id","examples":["507f1f77bcf86cd799439011"]},"type_label":{"type":"string","title":"Type Label"},"type_code":{"type":"string","title":"Type Code"},"count":{"type":"integer","minimum":0.0,"title":"Count","description":"Nombre de caches trouvées de ce type"}},"type":"object","required":["type_id","type_label","type_code","count"],"title":"CacheTypeStats","description":"Statistiques pour un type de cache spécifique.\n\nAttributes:\n    type_id (PyObjectId): Identifiant du type de cache.\n    type_label (str): Libellé du type de cache.\n    type_code (str): Code du type de cache.\n    count (int): Nombre de caches trouvées de ce type."},"CalendarResult":{"properties":{"total_days_365":{"type":"integer","title":"Total Days 365","default":365},"completed_days_365":{"type":"integer","title":"Completed Days 365"},"completion_rate_365":{"type":"number","title":"Completion Rate 365"},"calendar_tours":{"type":"integer","title":"Calendar Tours","default":0},"total_days_366":{"type":"integer","title":"Total Days 366","default":366},"completed_days_366":{"type":"integer","title":"Completed Days 366"},"completion_rate_366":{"type":"number","title":"Completion Rate 366"},"missing_days":{"items":{"type":"string"},"type":"array","title":"Missing Days"},"missing_days_by_month":{"additionalProperties":{"items":{"type":"string"},"type":"array"},"type":"object","title":"Missing Days By Month"},"completed_days":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Completed Days"},"cache_type_filter":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Cache Type Filter"},"cache_size_filter":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Cache Size Filter"}},"type":"object","required":["completed_days_365","completion_rate_365","completed_days_366","completion_rate_366","missing_days","missing_days_by_month","completed_days"],"title":"CalendarResult","description":"Result of calendar verification for a user."},"ChallengeDetail":{"properties":{"id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Id","examples":["507f1f77bcf86cd799439011"]},"name":{"type":"string","title":"Name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"}},"type":"object","required":["id","name"],"title":"ChallengeDetail","description":"Détail minimal challenge.\n\nAttributes:\n    id (PyObjectId): Id challenge.\n    name (str): Nom.\n    description (str | None): Description."},"ChallengeMini":{"properties":{"id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Id","examples":["507f1f77bcf86cd799439011"]},"name":{"type":"string","title":"Name"}},"type":"object","required":["id","name"],"title":"ChallengeMini","description":"Mini-référence challenge.\n\nAttributes:\n    id (PyObjectId): Id du challenge.\n    name (str): Nom du challenge."},"CountrySelector":{"properties":{"country_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Country Id"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name","description":"Cache country"}},"type":"object","title":"CountrySelector","description":"Sélecteur par pays.\n\nAttributes:\n    country_id (int | None): Identifiant numérique (référentiel).\n    name (str | None): Nom du pays."},"DetailResponse":{"properties":{"id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Id","examples":["507f1f77bcf86cd799439011"]},"status":{"type":"string","title":"Status"},"computed_status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Computed Status"},"effective_status":{"type":"string","title":"Effective Status"},"progress":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Progress"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"},"created_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Created At"},"manual_override":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Manual Override"},"override_reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Override Reason"},"overridden_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Overridden At"},"notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Notes"},"challenge":{"$ref":"#/components/schemas/ChallengeDetail"},"cache":{"$ref":"#/components/schemas/CacheDetail"}},"type":"object","required":["id","status","effective_status","challenge","cache"],"title":"DetailResponse","description":"Réponse détail UC.\n\nAttributes:\n    id (PyObjectId): Id UC.\n    status (str): Statut déclaré.\n    computed_status (str | None): Statut calculé.\n    effective_status (str): Statut effectif.\n    progress (dict | None): Snapshot simplifié.\n    updated_at (datetime | None): MAJ.\n    created_at (datetime | None): Création.\n    manual_override (bool | None): Override actif.\n    override_reason (str | None): Raison.\n    overridden_at (datetime | None): Date override.\n    notes (str | None): Notes.\n    challenge (ChallengeDetail): Détail challenge.\n    cache (CacheDetail): Détail cache."},"EvaluateNewPayload":{"properties":{"include_pending":{"type":"boolean","title":"Include Pending","default":false},"limit":{"type":"integer","title":"Limit","default":50},"since":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Since"}},"type":"object","title":"EvaluateNewPayload"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HealthCheck":{"properties":{"status":{"type":"string","title":"Status","description":"Overall status: ok, degraded, error"},"timestamp":{"type":"string","format":"date-time","title":"Timestamp"},"version":{"type":"string","title":"Version","description":"API version"},"checks":{"additionalProperties":{"type":"string"},"type":"object","title":"Checks","description":"Individual service checks"}},"type":"object","required":["status","version","checks"],"title":"HealthCheck","description":"Modèle de réponse health check","example":{"checks":{"database":"ok","email":"ok"},"status":"ok","timestamp":"2026-02-26T10:30:00Z","version":"0.1.0"}},"LocOut":{"properties":{"lat":{"type":"number","title":"Lat"},"lng":{"type":"number","title":"Lng"}},"type":"object","required":["lat","lng"],"title":"LocOut","description":"Coordonnées décimales.\n\nAttributes:\n    lat (float): Latitude.\n    lng (float): Longitude."},"MatrixResult":{"properties":{"total_combinations":{"type":"integer","title":"Total Combinations","default":81},"completed_combinations_count":{"type":"integer","title":"Completed Combinations Count"},"completion_rate":{"type":"number","title":"Completion Rate"},"matrix_tours":{"type":"integer","title":"Matrix Tours","default":0},"next_round_completed_count":{"type":"integer","title":"Next Round Completed Count"},"next_round_completion_rate":{"type":"number","title":"Next Round Completion Rate"},"missing_combinations":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Missing Combinations"},"missing_combinations_by_difficulty":{"additionalProperties":{"items":{"additionalProperties":true,"type":"object"},"type":"array"},"type":"object","title":"Missing Combinations By Difficulty"},"completed_combinations_details":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Completed Combinations Details"},"cache_type_filter":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Cache Type Filter"},"cache_size_filter":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Cache Size Filter"}},"type":"object","required":["completed_combinations_count","completion_rate","next_round_completed_count","next_round_completion_rate","missing_combinations","missing_combinations_by_difficulty","completed_combinations_details"],"title":"MatrixResult","description":"Result of matrix D/T verification for a user."},"MessageOut":{"properties":{"message":{"type":"string","title":"Message","examples":["OK"]}},"type":"object","required":["message"],"title":"MessageOut"},"PatchResponse":{"properties":{"id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Id","examples":["507f1f77bcf86cd799439011"]},"status":{"type":"string","title":"Status"},"computed_status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Computed Status"},"effective_status":{"type":"string","title":"Effective Status"},"manual_override":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Manual Override"},"override_reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Override Reason"},"overridden_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Overridden At"},"notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Notes"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"}},"type":"object","required":["id","status","effective_status"],"title":"PatchResponse","description":"Réponse au patch UC.\n\nAttributes:\n    id (PyObjectId): Id UC.\n    status (str): Statut déclaré.\n    computed_status (str | None): Statut calculé.\n    effective_status (str): Statut effectif.\n    manual_override (bool | None): Override actif.\n    override_reason (str | None): Raison.\n    overridden_at (datetime | None): Date override.\n    notes (str | None): Notes.\n    updated_at (datetime | None): MAJ."},"PatchUCIn":{"properties":{"status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Status","description":"pending|accepted|dismissed|completed"},"notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Notes"},"override_reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Override Reason","description":"Optionnel si status=completed (override manuel)"}},"type":"object","title":"PatchUCIn","description":"Entrée de patch d’un UserChallenge.\n\nAttributes:\n    status (str | None): Nouveau statut (`pending|accepted|dismissed|completed`).\n    notes (str | None): Notes.\n    override_reason (str | None): Raison d’override (si `status=completed` manuel)."},"ProgressEvaluateResponse":{"properties":{"_id":{"anyOf":[{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},{"type":"null"}],"title":"Id"},"user_challenge_id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"User Challenge Id","examples":["507f1f77bcf86cd799439011"]},"checked_at":{"type":"string","format":"date-time","title":"Checked At"},"aggregate":{"$ref":"#/components/schemas/ProgressSnapshot"},"tasks":{"items":{"$ref":"#/components/schemas/TaskProgressItemOut"},"type":"array","title":"Tasks"},"message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Message"},"estimated_completion_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Estimated Completion At"},"created_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Created At"}},"type":"object","required":["user_challenge_id","checked_at","aggregate"],"title":"ProgressEvaluateResponse","description":"Réponse POST /my/challenges/{uc_id}/progress/evaluate.\n\nDescription:\n    Hérite de `ProgressOut` (snapshot complet)."},"ProgressGetResponse":{"properties":{"latest":{"anyOf":[{"$ref":"#/components/schemas/ProgressOut"},{"type":"null"}]},"history":{"items":{"$ref":"#/components/schemas/ProgressHistoryItemOut"},"type":"array","title":"History"}},"type":"object","title":"ProgressGetResponse","description":"Réponse GET /my/challenges/{uc_id}/progress.\n\nAttributes:\n    latest (ProgressOut | None): Dernier snapshot disponible.\n    history (list[ProgressHistoryItemOut]): Historique court."},"ProgressHistoryItemOut":{"properties":{"checked_at":{"type":"string","format":"date-time","title":"Checked At"},"aggregate":{"$ref":"#/components/schemas/ProgressSnapshot"}},"type":"object","required":["checked_at","aggregate"],"title":"ProgressHistoryItemOut","description":"Entrée légère d’historique (timeline).\n\nAttributes:\n    checked_at (datetime): Timestamp de l’entrée.\n    aggregate (AggregateProgress): Agrégat à cet instant."},"ProgressOut":{"properties":{"_id":{"anyOf":[{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},{"type":"null"}],"title":"Id"},"user_challenge_id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"User Challenge Id","examples":["507f1f77bcf86cd799439011"]},"checked_at":{"type":"string","format":"date-time","title":"Checked At"},"aggregate":{"$ref":"#/components/schemas/ProgressSnapshot"},"tasks":{"items":{"$ref":"#/components/schemas/TaskProgressItemOut"},"type":"array","title":"Tasks"},"message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Message"},"estimated_completion_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Estimated Completion At"},"created_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Created At"}},"type":"object","required":["user_challenge_id","checked_at","aggregate"],"title":"ProgressOut","description":"Snapshot complet renvoyé par l’API.\n\nAttributes:\n    id (PyObjectId | None): Alias `_id`.\n    user_challenge_id (PyObjectId): UC visé.\n    checked_at (datetime): Horodatage du snapshot.\n    aggregate (AggregateProgress): Agrégat global.\n    tasks (list[TaskProgressItemOut]): Détails par tâche.\n    message (str | None): Annotation éventuelle.\n    created_at (datetime | None): Traçabilité serveur."},"ProgressSnapshot":{"properties":{"percent":{"type":"number","title":"Percent","default":0.0},"tasks_done":{"type":"integer","title":"Tasks Done","default":0},"tasks_total":{"type":"integer","title":"Tasks Total","default":0},"checked_at":{"type":"string","format":"date-time","title":"Checked At"}},"type":"object","title":"ProgressSnapshot","description":"Snapshot agrégé de progression.\n\nDescription:\n    Représente l’état courant d’un ensemble de tâches (pour un challenge ou une tâche),\n    avec pourcentage global, nombre de tâches terminées et total.\n\nAttributes:\n    percent (float): Avancement global (0–100).\n    tasks_done (int): Nombre de tâches terminées.\n    tasks_total (int): Nombre total de tâches.\n    checked_at (datetime): Timestamp de calcul (local).\n\nReturns:\n    ProgressSnapshot: Objet prêt à sérialiser (encodage ObjectId géré)."},"Range":{"properties":{"min":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Min"},"max":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Max"}},"type":"object","title":"Range","description":"Range for numeric filters (e.g., difficulty, terrain)."},"RefreshIn":{"properties":{"cache_ids":{"anyOf":[{"items":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},"type":"array"},{"type":"null"}],"title":"Cache Ids","description":"Liste optionnelle de cache_ids (_id Mongo) à considérer; si absent, balaye toute la collection."}},"type":"object","title":"RefreshIn"},"RefreshTokenRequest":{"properties":{"refresh_token":{"type":"string","title":"Refresh Token"}},"type":"object","required":["refresh_token"],"title":"RefreshTokenRequest","description":"Entrée de refresh token.\n\nAttributes:\n    refresh_token (str): Jeton de refresh JWT."},"ResendVerificationRequest":{"properties":{"identifier":{"type":"string","title":"Identifier"}},"type":"object","required":["identifier"],"title":"ResendVerificationRequest","description":"Entrée de renvoi de vérification email.\n\nAttributes:\n    identifier (str): Email ou username."},"RuleAggSumAltitudeAtLeast":{"properties":{"kind":{"type":"string","const":"aggregate_sum_altitude_at_least","title":"Kind","default":"aggregate_sum_altitude_at_least"},"min_total":{"type":"integer","minimum":1.0,"title":"Min Total"}},"type":"object","required":["min_total"],"title":"RuleAggSumAltitudeAtLeast","description":"Règle agrégée: somme(altitude) ≥ min_total."},"RuleAggSumDiffPlusTerrAtLeast":{"properties":{"kind":{"type":"string","const":"aggregate_sum_diff_plus_terr_at_least","title":"Kind","default":"aggregate_sum_diff_plus_terr_at_least"},"min_total":{"type":"integer","minimum":1.0,"title":"Min Total"}},"type":"object","required":["min_total"],"title":"RuleAggSumDiffPlusTerrAtLeast","description":"Règle agrégée: somme(difficulté+terrain) ≥ min_total."},"RuleAggSumDifficultyAtLeast":{"properties":{"kind":{"type":"string","const":"aggregate_sum_difficulty_at_least","title":"Kind","default":"aggregate_sum_difficulty_at_least"},"min_total":{"type":"integer","minimum":1.0,"title":"Min Total"}},"type":"object","required":["min_total"],"title":"RuleAggSumDifficultyAtLeast","description":"Règle agrégée: somme(difficulté) ≥ min_total (sur l’ensemble de trouvailles éligibles)."},"RuleAggSumTerrainAtLeast":{"properties":{"kind":{"type":"string","const":"aggregate_sum_terrain_at_least","title":"Kind","default":"aggregate_sum_terrain_at_least"},"min_total":{"type":"integer","minimum":1.0,"title":"Min Total"}},"type":"object","required":["min_total"],"title":"RuleAggSumTerrainAtLeast","description":"Règle agrégée: somme(terrain) ≥ min_total (sur l’ensemble de trouvailles éligibles)."},"RuleAttributes":{"properties":{"kind":{"type":"string","const":"attributes","title":"Kind","default":"attributes"},"attributes":{"items":{"$ref":"#/components/schemas/AttributeSelector"},"type":"array","title":"Attributes"}},"type":"object","required":["attributes"],"title":"RuleAttributes","description":"Règle: ensemble d’attributs (±)."},"RuleCountryIs":{"properties":{"kind":{"type":"string","const":"country_is","title":"Kind","default":"country_is"},"country":{"$ref":"#/components/schemas/CountrySelector"}},"type":"object","required":["country"],"title":"RuleCountryIs","description":"Règle: pays == valeur (sélecteur unique)."},"RuleDifficultyBetween":{"properties":{"kind":{"type":"string","const":"difficulty_between","title":"Kind","default":"difficulty_between"},"min":{"type":"number","maximum":5.0,"minimum":1.0,"title":"Min"},"max":{"type":"number","maximum":5.0,"minimum":1.0,"title":"Max"}},"type":"object","required":["min","max"],"title":"RuleDifficultyBetween","description":"Règle: difficulté ∈ [min, max] (1.0–5.0)."},"RulePlacedAfter":{"properties":{"kind":{"type":"string","const":"placed_after","title":"Kind","default":"placed_after"},"date":{"type":"string","format":"date","title":"Date"}},"type":"object","required":["date"],"title":"RulePlacedAfter","description":"Règle: cache placée **après** la date donnée (incluse/exclue selon logique d’évaluation)."},"RulePlacedBefore":{"properties":{"kind":{"type":"string","const":"placed_before","title":"Kind","default":"placed_before"},"date":{"type":"string","format":"date","title":"Date"}},"type":"object","required":["date"],"title":"RulePlacedBefore","description":"Règle: cache placée **avant** la date donnée (incluse/exclue selon logique d’évaluation)."},"RulePlacedYear":{"properties":{"kind":{"type":"string","const":"placed_year","title":"Kind","default":"placed_year"},"year":{"type":"integer","maximum":2100.0,"minimum":1999.0,"title":"Year"}},"type":"object","required":["year"],"title":"RulePlacedYear","description":"Règle: cache placée l’année donnée (bornée côté modèle)."},"RuleSizeIn":{"properties":{"kind":{"type":"string","const":"size_in","title":"Kind","default":"size_in"},"sizes":{"items":{"$ref":"#/components/schemas/SizeSelector"},"type":"array","title":"Sizes"}},"type":"object","required":["sizes"],"title":"RuleSizeIn","description":"Règle: taille ∈ {…}."},"RuleStateIn":{"properties":{"kind":{"type":"string","const":"state_in","title":"Kind","default":"state_in"},"state_ids":{"items":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},"type":"array","title":"State Ids"}},"type":"object","required":["state_ids"],"title":"RuleStateIn","description":"Règle: État ∈ {…} (liste d’ObjectId)."},"RuleTerrainBetween":{"properties":{"kind":{"type":"string","const":"terrain_between","title":"Kind","default":"terrain_between"},"min":{"type":"number","maximum":5.0,"minimum":1.0,"title":"Min"},"max":{"type":"number","maximum":5.0,"minimum":1.0,"title":"Max"}},"type":"object","required":["min","max"],"title":"RuleTerrainBetween","description":"Règle: terrain ∈ [min, max] (1.0–5.0)."},"RuleTypeIn":{"properties":{"kind":{"type":"string","const":"type_in","title":"Kind","default":"type_in"},"types":{"items":{"$ref":"#/components/schemas/TypeSelector"},"type":"array","title":"Types"}},"type":"object","required":["types"],"title":"RuleTypeIn","description":"Règle: type ∈ {…}."},"SizeSelector":{"properties":{"cache_size_doc_id":{"anyOf":[{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},{"type":"null"}],"title":"Cache Size Doc Id"},"cache_size_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Cache Size Id"},"code":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Code","description":"Cache size code"}},"type":"object","title":"SizeSelector","description":"Sélecteur par taille de cache.\n\nAttributes:\n    cache_size_doc_id (PyObjectId | None): Réf. `cache_sizes._id`.\n    cache_size_id (int | None): Identifiant numérique global.\n    code (str | None): Code de taille."},"TargetListItemOut":{"properties":{"id":{"type":"string","title":"Id"},"user_challenge_id":{"type":"string","title":"User Challenge Id"},"cache_id":{"type":"string","title":"Cache Id"},"GC":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Gc"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"},"loc":{"anyOf":[{"$ref":"#/components/schemas/LocOut"},{"type":"null"}]},"matched_task_ids":{"items":{"type":"string"},"type":"array","title":"Matched Task Ids"},"primary_task_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Primary Task Id"},"score":{"type":"number","title":"Score"},"reasons":{"items":{"type":"string"},"type":"array","title":"Reasons"},"pinned":{"type":"boolean","title":"Pinned","default":false},"distance_km":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Distance Km"}},"type":"object","required":["id","user_challenge_id","cache_id","score"],"title":"TargetListItemOut","description":"Élément de liste « target ».\n\nDescription:\n    Représente une cache candidate qui satisfait ≥1 tâche. `distance_km` n’est présent\n    que pour les endpoints « nearby ».\n\nAttributes:\n    id (str): Id du document target.\n    user_challenge_id (str): UC concerné.\n    cache_id (str): Cache ciblée.\n    GC (str | None): Code GC (si jointure).\n    name (str | None): Nom de la cache (si jointure).\n    loc (LocOut | None): Coordonnées (si jointure).\n    matched_task_ids (list[str]): Tâches satisfaites.\n    primary_task_id (str | None): Tâche principale.\n    score (float): Score de tri.\n    reasons (list[str]): Raisons textuelles.\n    pinned (bool): Épinglée.\n    distance_km (float | None): Distance (si mode nearby)."},"TargetListResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/TargetListItemOut"},"type":"array","title":"Items"},"nb_items":{"type":"integer","title":"Nb Items"},"page":{"type":"integer","title":"Page"},"page_size":{"type":"integer","title":"Page Size"},"nb_pages":{"type":"integer","title":"Nb Pages"}},"type":"object","required":["items","nb_items","page","page_size","nb_pages"],"title":"TargetListResponse","description":"Réponse liste paginée de targets.\n\nAttributes:\n    items (list[TargetListItemOut]): Résultats.\n    nb_items (int): Nb items trouvés.\n    page (int): Page courante.\n    page_size (int): Taille de page.\n    nb_pages (int): Nombre de pages."},"TaskAnd-Input":{"properties":{"kind":{"type":"string","const":"and","title":"Kind","default":"and"},"nodes":{"items":{"anyOf":[{"$ref":"#/components/schemas/TaskAnd-Input"},{"$ref":"#/components/schemas/TaskOr-Input"},{"$ref":"#/components/schemas/TaskNot-Input"},{"$ref":"#/components/schemas/RuleTypeIn"},{"$ref":"#/components/schemas/RuleSizeIn"},{"$ref":"#/components/schemas/RulePlacedYear"},{"$ref":"#/components/schemas/RulePlacedBefore"},{"$ref":"#/components/schemas/RulePlacedAfter"},{"$ref":"#/components/schemas/RuleStateIn"},{"$ref":"#/components/schemas/RuleCountryIs"},{"$ref":"#/components/schemas/RuleDifficultyBetween"},{"$ref":"#/components/schemas/RuleTerrainBetween"},{"$ref":"#/components/schemas/RuleAttributes"},{"$ref":"#/components/schemas/RuleAggSumDifficultyAtLeast"},{"$ref":"#/components/schemas/RuleAggSumTerrainAtLeast"},{"$ref":"#/components/schemas/RuleAggSumDiffPlusTerrAtLeast"},{"$ref":"#/components/schemas/RuleAggSumAltitudeAtLeast"}]},"type":"array","title":"Nodes"}},"type":"object","required":["nodes"],"title":"TaskAnd","description":"Nœud logique AND.\n\nAttributes:\n    nodes (list[TaskAnd | TaskOr | TaskNot | TaskLeaf]): Sous-nœuds."},"TaskAnd-Output":{"properties":{"kind":{"type":"string","const":"and","title":"Kind","default":"and"},"nodes":{"items":{"anyOf":[{"$ref":"#/components/schemas/TaskAnd-Output"},{"$ref":"#/components/schemas/TaskOr-Output"},{"$ref":"#/components/schemas/TaskNot-Output"},{"$ref":"#/components/schemas/RuleTypeIn"},{"$ref":"#/components/schemas/RuleSizeIn"},{"$ref":"#/components/schemas/RulePlacedYear"},{"$ref":"#/components/schemas/RulePlacedBefore"},{"$ref":"#/components/schemas/RulePlacedAfter"},{"$ref":"#/components/schemas/RuleStateIn"},{"$ref":"#/components/schemas/RuleCountryIs"},{"$ref":"#/components/schemas/RuleDifficultyBetween"},{"$ref":"#/components/schemas/RuleTerrainBetween"},{"$ref":"#/components/schemas/RuleAttributes"},{"$ref":"#/components/schemas/RuleAggSumDifficultyAtLeast"},{"$ref":"#/components/schemas/RuleAggSumTerrainAtLeast"},{"$ref":"#/components/schemas/RuleAggSumDiffPlusTerrAtLeast"},{"$ref":"#/components/schemas/RuleAggSumAltitudeAtLeast"}]},"type":"array","title":"Nodes"}},"type":"object","required":["nodes"],"title":"TaskAnd","description":"Nœud logique AND.\n\nAttributes:\n    nodes (list[TaskAnd | TaskOr | TaskNot | TaskLeaf]): Sous-nœuds."},"TaskIn":{"properties":{"id":{"anyOf":[{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},{"type":"null"}],"title":"Id","description":"Task id if updating"},"title":{"anyOf":[{"type":"string","maxLength":200},{"type":"null"}],"title":"Title"},"expression":{"anyOf":[{"$ref":"#/components/schemas/TaskAnd-Input"},{"$ref":"#/components/schemas/TaskOr-Input"},{"$ref":"#/components/schemas/TaskNot-Input"},{"$ref":"#/components/schemas/RuleTypeIn"},{"$ref":"#/components/schemas/RuleSizeIn"},{"$ref":"#/components/schemas/RulePlacedYear"},{"$ref":"#/components/schemas/RulePlacedBefore"},{"$ref":"#/components/schemas/RulePlacedAfter"},{"$ref":"#/components/schemas/RuleStateIn"},{"$ref":"#/components/schemas/RuleCountryIs"},{"$ref":"#/components/schemas/RuleDifficultyBetween"},{"$ref":"#/components/schemas/RuleTerrainBetween"},{"$ref":"#/components/schemas/RuleAttributes"},{"$ref":"#/components/schemas/RuleAggSumDifficultyAtLeast"},{"$ref":"#/components/schemas/RuleAggSumTerrainAtLeast"},{"$ref":"#/components/schemas/RuleAggSumDiffPlusTerrAtLeast"},{"$ref":"#/components/schemas/RuleAggSumAltitudeAtLeast"}],"title":"Expression","description":"AST expression for this task"},"constraints":{"additionalProperties":true,"type":"object","title":"Constraints","description":"Ex: {'min_count': 4}"},"status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Status","description":"Optional manual status: 'todo' | 'in_progress' | 'done'"}},"type":"object","required":["expression","constraints"],"title":"TaskIn","description":"Entrée pour une tâche.\n\nAttributes:\n    id (PyObjectId | None): Id de tâche (si update).\n    title (str | None): Titre (≤ 200).\n    expression (TaskExpression): AST de la tâche.\n    constraints (dict[str, Any]): Contraintes (ex. {'min_count': 4}).\n    status (str | None): 'todo' | 'in_progress' | 'done' (optionnel)."},"TaskNot-Input":{"properties":{"kind":{"type":"string","const":"not","title":"Kind","default":"not"},"node":{"anyOf":[{"$ref":"#/components/schemas/TaskAnd-Input"},{"$ref":"#/components/schemas/TaskOr-Input"},{"$ref":"#/components/schemas/RuleTypeIn"},{"$ref":"#/components/schemas/RuleSizeIn"},{"$ref":"#/components/schemas/RulePlacedYear"},{"$ref":"#/components/schemas/RulePlacedBefore"},{"$ref":"#/components/schemas/RulePlacedAfter"},{"$ref":"#/components/schemas/RuleStateIn"},{"$ref":"#/components/schemas/RuleCountryIs"},{"$ref":"#/components/schemas/RuleDifficultyBetween"},{"$ref":"#/components/schemas/RuleTerrainBetween"},{"$ref":"#/components/schemas/RuleAttributes"},{"$ref":"#/components/schemas/RuleAggSumDifficultyAtLeast"},{"$ref":"#/components/schemas/RuleAggSumTerrainAtLeast"},{"$ref":"#/components/schemas/RuleAggSumDiffPlusTerrAtLeast"},{"$ref":"#/components/schemas/RuleAggSumAltitudeAtLeast"}],"title":"Node"}},"type":"object","required":["node"],"title":"TaskNot","description":"Nœud logique NOT.\n\nAttributes:\n    node (TaskAnd | TaskOr | TaskLeaf): Sous-nœud."},"TaskNot-Output":{"properties":{"kind":{"type":"string","const":"not","title":"Kind","default":"not"},"node":{"anyOf":[{"$ref":"#/components/schemas/TaskAnd-Output"},{"$ref":"#/components/schemas/TaskOr-Output"},{"$ref":"#/components/schemas/RuleTypeIn"},{"$ref":"#/components/schemas/RuleSizeIn"},{"$ref":"#/components/schemas/RulePlacedYear"},{"$ref":"#/components/schemas/RulePlacedBefore"},{"$ref":"#/components/schemas/RulePlacedAfter"},{"$ref":"#/components/schemas/RuleStateIn"},{"$ref":"#/components/schemas/RuleCountryIs"},{"$ref":"#/components/schemas/RuleDifficultyBetween"},{"$ref":"#/components/schemas/RuleTerrainBetween"},{"$ref":"#/components/schemas/RuleAttributes"},{"$ref":"#/components/schemas/RuleAggSumDifficultyAtLeast"},{"$ref":"#/components/schemas/RuleAggSumTerrainAtLeast"},{"$ref":"#/components/schemas/RuleAggSumDiffPlusTerrAtLeast"},{"$ref":"#/components/schemas/RuleAggSumAltitudeAtLeast"}],"title":"Node"}},"type":"object","required":["node"],"title":"TaskNot","description":"Nœud logique NOT.\n\nAttributes:\n    node (TaskAnd | TaskOr | TaskLeaf): Sous-nœud."},"TaskOr-Input":{"properties":{"kind":{"type":"string","const":"or","title":"Kind","default":"or"},"nodes":{"items":{"anyOf":[{"$ref":"#/components/schemas/TaskAnd-Input"},{"$ref":"#/components/schemas/TaskOr-Input"},{"$ref":"#/components/schemas/TaskNot-Input"},{"$ref":"#/components/schemas/RuleTypeIn"},{"$ref":"#/components/schemas/RuleSizeIn"},{"$ref":"#/components/schemas/RulePlacedYear"},{"$ref":"#/components/schemas/RulePlacedBefore"},{"$ref":"#/components/schemas/RulePlacedAfter"},{"$ref":"#/components/schemas/RuleStateIn"},{"$ref":"#/components/schemas/RuleCountryIs"},{"$ref":"#/components/schemas/RuleDifficultyBetween"},{"$ref":"#/components/schemas/RuleTerrainBetween"},{"$ref":"#/components/schemas/RuleAttributes"},{"$ref":"#/components/schemas/RuleAggSumDifficultyAtLeast"},{"$ref":"#/components/schemas/RuleAggSumTerrainAtLeast"},{"$ref":"#/components/schemas/RuleAggSumDiffPlusTerrAtLeast"},{"$ref":"#/components/schemas/RuleAggSumAltitudeAtLeast"}]},"type":"array","title":"Nodes"}},"type":"object","required":["nodes"],"title":"TaskOr","description":"Nœud logique OR.\n\nAttributes:\n    nodes (list[TaskAnd | TaskOr | TaskNot | TaskLeaf]): Sous-nœuds."},"TaskOr-Output":{"properties":{"kind":{"type":"string","const":"or","title":"Kind","default":"or"},"nodes":{"items":{"anyOf":[{"$ref":"#/components/schemas/TaskAnd-Output"},{"$ref":"#/components/schemas/TaskOr-Output"},{"$ref":"#/components/schemas/TaskNot-Output"},{"$ref":"#/components/schemas/RuleTypeIn"},{"$ref":"#/components/schemas/RuleSizeIn"},{"$ref":"#/components/schemas/RulePlacedYear"},{"$ref":"#/components/schemas/RulePlacedBefore"},{"$ref":"#/components/schemas/RulePlacedAfter"},{"$ref":"#/components/schemas/RuleStateIn"},{"$ref":"#/components/schemas/RuleCountryIs"},{"$ref":"#/components/schemas/RuleDifficultyBetween"},{"$ref":"#/components/schemas/RuleTerrainBetween"},{"$ref":"#/components/schemas/RuleAttributes"},{"$ref":"#/components/schemas/RuleAggSumDifficultyAtLeast"},{"$ref":"#/components/schemas/RuleAggSumTerrainAtLeast"},{"$ref":"#/components/schemas/RuleAggSumDiffPlusTerrAtLeast"},{"$ref":"#/components/schemas/RuleAggSumAltitudeAtLeast"}]},"type":"array","title":"Nodes"}},"type":"object","required":["nodes"],"title":"TaskOr","description":"Nœud logique OR.\n\nAttributes:\n    nodes (list[TaskAnd | TaskOr | TaskNot | TaskLeaf]): Sous-nœuds."},"TaskOut":{"properties":{"id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Id","examples":["507f1f77bcf86cd799439011"]},"order":{"type":"integer","title":"Order"},"title":{"type":"string","title":"Title"},"expression":{"anyOf":[{"$ref":"#/components/schemas/TaskAnd-Output"},{"$ref":"#/components/schemas/TaskOr-Output"},{"$ref":"#/components/schemas/TaskNot-Output"},{"$ref":"#/components/schemas/RuleTypeIn"},{"$ref":"#/components/schemas/RuleSizeIn"},{"$ref":"#/components/schemas/RulePlacedYear"},{"$ref":"#/components/schemas/RulePlacedBefore"},{"$ref":"#/components/schemas/RulePlacedAfter"},{"$ref":"#/components/schemas/RuleStateIn"},{"$ref":"#/components/schemas/RuleCountryIs"},{"$ref":"#/components/schemas/RuleDifficultyBetween"},{"$ref":"#/components/schemas/RuleTerrainBetween"},{"$ref":"#/components/schemas/RuleAttributes"},{"$ref":"#/components/schemas/RuleAggSumDifficultyAtLeast"},{"$ref":"#/components/schemas/RuleAggSumTerrainAtLeast"},{"$ref":"#/components/schemas/RuleAggSumDiffPlusTerrAtLeast"},{"$ref":"#/components/schemas/RuleAggSumAltitudeAtLeast"}],"title":"Expression"},"constraints":{"additionalProperties":true,"type":"object","title":"Constraints"},"status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Status"},"metrics":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Metrics"},"progress":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Progress"},"start_found_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Start Found At"},"completed_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Completed At"},"last_evaluated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Evaluated At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"},"created_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Created At"}},"type":"object","required":["id","order","title","expression","constraints"],"title":"TaskOut","description":"Sortie d’une tâche.\n\nAttributes:\n    id (PyObjectId): Id de tâche.\n    order (int): Ordre.\n    title (str): Titre.\n    expression (TaskExpression): AST.\n    constraints (dict[str, Any]): Contraintes.\n    status (str | None): Statut manuel.\n    metrics (dict[str, Any] | None): Métriques.\n    progress (dict[str, Any] | None): Snapshot courant.\n    last_evaluated_at (datetime | None): Dernière évaluation.\n    updated_at (datetime | None): MAJ.\n    created_at (datetime | None): Création."},"TaskProgressItemOut":{"properties":{"task_id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Task Id","description":"Id of the task","examples":["507f1f77bcf86cd799439011"]},"order":{"type":"integer","minimum":0.0,"title":"Order","description":"Task order within the challenge"},"title":{"anyOf":[{"type":"string","maxLength":200},{"type":"null"}],"title":"Title"},"supported_for_progress":{"type":"boolean","title":"Supported For Progress","default":true},"compiled_signature":{"type":"string","title":"Compiled Signature","description":"Stable signature of compiled AND subtree, or a tag like 'override:done' / 'unsupported:or-not'"},"aggregate":{"anyOf":[{"$ref":"#/components/schemas/AggregateProgressOut"},{"type":"null"}]},"min_count":{"type":"integer","minimum":0.0,"title":"Min Count"},"current_count":{"type":"integer","minimum":0.0,"title":"Current Count"},"percent":{"type":"number","maximum":100.0,"minimum":0.0,"title":"Percent"},"notes":{"items":{"type":"string"},"type":"array","title":"Notes"},"evaluated_in_ms":{"type":"integer","minimum":0.0,"title":"Evaluated In Ms","default":0},"start_found_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Start Found At"},"completed_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Completed At"},"estimated_completion_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Estimated Completion At"},"last_evaluated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Evaluated At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"},"created_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Created At"}},"type":"object","required":["task_id","order","compiled_signature","min_count","current_count","percent"],"title":"TaskProgressItemOut","description":"Snapshot par tâche renvoyé par l’API.\n\nDescription:\n    Vu « client », prêt à afficher : ordre, titre, drapeaux de support, signature compilée,\n    agrégat, compteurs/percent (arrondi), diagnostics et timestamps.\n\nAttributes:\n    task_id (PyObjectId): Identifiant de tâche.\n    order (int): Ordre de la tâche dans le challenge.\n    title (str | None): Titre (si disponible).\n    supported_for_progress (bool): Inclus dans les agrégats globaux.\n    compiled_signature (str): Empreinte stable ou tag ('override:done', 'unsupported:or-not', …).\n    aggregate (AggregateProgressOut | None): Agrégat propre à la tâche.\n    min_count (int): Seuil attendu.\n    current_count (int): Mesure actuelle.\n    percent (float): Avancement (0–100, arrondi à 1 décimale).\n    notes (list[str]): Diagnostics.\n    evaluated_in_ms (int): Durée d’évaluation.\n    last_evaluated_at (datetime | None): Dernière évaluation.\n    updated_at (datetime | None): MAJ serveur.\n    created_at (datetime | None): Création."},"TasksListResponse":{"properties":{"tasks":{"items":{"$ref":"#/components/schemas/TaskOut"},"type":"array","title":"Tasks"}},"type":"object","required":["tasks"],"title":"TasksListResponse","description":"Réponse: liste de tâches.\n\nAttributes:\n    tasks (list[TaskOut]): Tâches ordonnées."},"TasksPutIn":{"properties":{"tasks":{"items":{"$ref":"#/components/schemas/TaskIn"},"type":"array","maxItems":50,"minItems":0,"title":"Tasks"}},"type":"object","title":"TasksPutIn","description":"Entrée PUT pour remplacer la liste complète de tâches.\n\nAttributes:\n    tasks (conlist[TaskIn]): Liste de 0 à 50 tâches."},"TasksValidateIn":{"properties":{"tasks":{"items":{"$ref":"#/components/schemas/TaskIn"},"type":"array","maxItems":50,"minItems":0,"title":"Tasks"}},"type":"object","title":"TasksValidateIn","description":"Entrée POST de validation de tâches (sans persistance).\n\nAttributes:\n    tasks (conlist[TaskIn]): Liste de 0 à 50 tâches à valider."},"TasksValidateResponse":{"properties":{"ok":{"type":"boolean","title":"Ok"},"errors":{"items":{"$ref":"#/components/schemas/ValidationErrorItem"},"type":"array","title":"Errors","default":[]}},"type":"object","required":["ok"],"title":"TasksValidateResponse","description":"Résultat de validation.\n\nAttributes:\n    ok (bool): True si aucune erreur.\n    errors (list[ValidationErrorItem]): Erreurs détaillées."},"TokenPair":{"properties":{"access_token":{"type":"string","title":"Access Token"},"refresh_token":{"type":"string","title":"Refresh Token"},"token_type":{"type":"string","title":"Token Type","default":"bearer"}},"type":"object","required":["access_token","refresh_token"],"title":"TokenPair","description":"Couple de jetons JWT.\n\nAttributes:\n    access_token (str): Jeton d’accès.\n    refresh_token (str): Jeton de refresh.\n    token_type (str): 'bearer'."},"TokenResponse":{"properties":{"access_token":{"type":"string","title":"Access Token"},"token_type":{"type":"string","title":"Token Type","default":"bearer"}},"type":"object","required":["access_token"],"title":"TokenResponse","description":"Réponse avec jeton d’accès.\n\nAttributes:\n    access_token (str): Jeton d’accès.\n    token_type (str): 'bearer'."},"TypeSelector":{"properties":{"cache_type_doc_id":{"anyOf":[{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","examples":["507f1f77bcf86cd799439011"]},{"type":"null"}],"title":"Cache Type Doc Id"},"cache_type_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Cache Type Id"},"code":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Code","description":"Cache type code, e.g. 'whereigo'"}},"type":"object","title":"TypeSelector","description":"Sélecteur par type de cache.\n\nAttributes:\n    cache_type_doc_id (PyObjectId | None): Réf. `cache_types._id`.\n    cache_type_id (int | None): Identifiant numérique global.\n    cache_type_code (str | None): Code type (ex. \"whereigo\")."},"UserChallengeListItemOut":{"properties":{"id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Id","examples":["507f1f77bcf86cd799439011"]},"status":{"type":"string","title":"Status"},"computed_status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Computed Status"},"effective_status":{"type":"string","title":"Effective Status"},"progress":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Progress"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"},"challenge":{"$ref":"#/components/schemas/ChallengeMini"},"cache":{"$ref":"#/components/schemas/CacheDetail"}},"type":"object","required":["id","status","effective_status","challenge","cache"],"title":"UserChallengeListItemOut","description":"Élément de liste UC.\n\nAttributes:\n    id (PyObjectId): Id UC.\n    status (str): Statut déclaré.\n    computed_status (str | None): Statut calculé.\n    effective_status (str): Statut effectif.\n    progress (dict | None): Snapshot simplifié.\n    updated_at (datetime | None): MAJ.\n    challenge (ChallengeMini): Réf. challenge.\n    cache (CacheDetail): Réf. cache liée."},"UserChallengeListResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/UserChallengeListItemOut"},"type":"array","title":"Items"},"nb_items":{"type":"integer","title":"Nb Items"},"page":{"type":"integer","title":"Page"},"page_size":{"type":"integer","title":"Page Size"},"nb_pages":{"type":"integer","title":"Nb Pages"}},"type":"object","required":["items","nb_items","page","page_size","nb_pages"],"title":"UserChallengeListResponse","description":"Réponse de liste paginée UC.\n\nAttributes:\n    items (list[UserChallengeListItemOut]): Résultats.\n    nb_items (int): Nb items trouvés.\n    page (int): Page courante.\n    nb_pages (int): Nombre de pages.\n    page_size (int): Taille de page."},"UserInRegister":{"properties":{"username":{"type":"string","maxLength":30,"minLength":3,"title":"Username"},"email":{"type":"string","format":"email","title":"Email"},"password":{"type":"string","minLength":8,"title":"Password"}},"type":"object","required":["username","email","password"],"title":"UserInRegister","description":"Entrée d’inscription.\n\nAttributes:\n    username (str): 3–30 caractères.\n    email (EmailStr): Email valide.\n    password (str): ≥ 8 caractères."},"UserLocationIn":{"properties":{"lat":{"anyOf":[{"type":"number","maximum":90.0,"minimum":-90.0},{"type":"null"}],"title":"Lat"},"lon":{"anyOf":[{"type":"number","maximum":180.0,"minimum":-180.0},{"type":"null"}],"title":"Lon"},"position":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Position"}},"type":"object","title":"UserLocationIn","description":"Entrée de localisation.\n\nDescription:\n    Deux formats acceptés :\n    - coordonnées numériques (`lat`, `lon`)\n    - chaîne `position` (DD/DM/DMS) à parser côté service.\n\nAttributes:\n    lat (float | None): Latitude (-90..90).\n    lon (float | None): Longitude (-180..180).\n    position (str | None): Représentation texte des coordonnées."},"UserLocationOut":{"properties":{"id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Id","examples":["507f1f77bcf86cd799439011"]},"lat":{"type":"number","title":"Lat"},"lon":{"type":"number","title":"Lon"},"updated_at":{"type":"string","format":"date-time","title":"Updated At"},"coords":{"type":"string","title":"Coords","description":"Représentation en degrés/minutes (calculé automatiquement).","readOnly":true}},"type":"object","required":["id","lat","lon","coords"],"title":"UserLocationOut","description":"Sortie de localisation utilisateur."},"UserOut":{"properties":{"_id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"Id","examples":["507f1f77bcf86cd799439011"]},"email":{"type":"string","format":"email","title":"Email"},"username":{"type":"string","title":"Username"},"role":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Role","default":"user"}},"type":"object","required":["_id","email","username"],"title":"UserOut","description":"Sortie publique utilisateur.\n\nAttributes:\n    id (PyObjectId): Alias `_id`.\n    email (EmailStr): Email.\n    username (str): Pseudo.\n    role (str | None): Rôle."},"UserStatsOut":{"properties":{"user_id":{"type":"string","pattern":"^[a-fA-F0-9]{24}$","format":"objectid","title":"User Id","examples":["507f1f77bcf86cd799439011"]},"username":{"type":"string","title":"Username"},"total_caches_found":{"type":"integer","minimum":0.0,"title":"Total Caches Found","description":"Nombre total de caches trouvées"},"total_challenges":{"type":"integer","minimum":0.0,"title":"Total Challenges","description":"Nombre total de challenges"},"active_challenges":{"type":"integer","minimum":0.0,"title":"Active Challenges","description":"Challenges actifs (accepted)"},"completed_challenges":{"type":"integer","minimum":0.0,"title":"Completed Challenges","description":"Challenges terminés"},"first_cache_found_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"First Cache Found At","description":"Date de la première cache trouvée"},"last_cache_found_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Cache Found At","description":"Date de la dernière cache trouvée"},"created_at":{"type":"string","format":"date-time","title":"Created At","description":"Date de création du compte"},"last_activity_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Activity At","description":"Dernière activité"},"cache_types_stats":{"anyOf":[{"items":{"$ref":"#/components/schemas/CacheTypeStats"},"type":"array"},{"type":"null"}],"title":"Cache Types Stats","description":"Statistiques par type de cache"}},"type":"object","required":["user_id","username","total_caches_found","total_challenges","active_challenges","completed_challenges","created_at"],"title":"UserStatsOut","description":"Statistiques synthétiques d'un utilisateur.\n\nAttributes:\n    user_id (PyObjectId): Identifiant utilisateur.\n    username (str): Nom d'utilisateur.\n    total_caches_found (int): Nombre total de caches trouvées.\n    total_challenges (int): Nombre total de challenges.\n    active_challenges (int): Nombre de challenges actifs (accepted).\n    completed_challenges (int): Nombre de challenges terminés.\n    first_cache_found_at (datetime | None): Date de la première cache trouvée.\n    last_cache_found_at (datetime | None): Date de la dernière cache trouvée.\n    created_at (datetime): Date de création du compte.\n    last_activity_at (datetime | None): Dernière activité (cache trouvée ou challenge créé).\n    cache_types_stats (list[CacheTypeStats] | None): Statistiques par type de cache."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"ValidationErrorItem":{"properties":{"index":{"type":"integer","title":"Index"},"field":{"type":"string","title":"Field"},"code":{"type":"string","title":"Code"},"message":{"type":"string","title":"Message"}},"type":"object","required":["index","field","code","message"],"title":"ValidationErrorItem","description":"Erreur de validation (itemisée).\n\nAttributes:\n    index (int): Index dans la liste d’entrée.\n    field (str): Champ concerné.\n    code (str): Code d’erreur.\n    message (str): Message lisible."},"VerifyEmailBody":{"properties":{"code":{"type":"string","title":"Code"}},"type":"object","required":["code"],"title":"VerifyEmailBody","description":"Request body for email verification."},"VersionInfo":{"properties":{"version":{"type":"string","title":"Version","description":"Version de l'API (semver)"},"environment":{"type":"string","title":"Environment","description":"Environnement (dev, staging, prod)"},"build_date":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Build Date","description":"Date de build"}},"type":"object","required":["version","environment"],"title":"VersionInfo","description":"Informations de version","example":{"build_date":"2026-02-26T10:00:00Z","environment":"production","version":"0.1.0"}}},"securitySchemes":{"OAuth2PasswordBearer":{"type":"oauth2","flows":{"password":{"scopes":{},"tokenUrl":"/auth/login"}}}}}}